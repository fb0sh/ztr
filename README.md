# ZTR - æ™ºèƒ½å‹ç¼©å·¥å…·

ä¸€ä¸ªåŸºäºé…ç½®æ–‡ä»¶çš„æ™ºèƒ½å‹ç¼©å·¥å…·ï¼Œæ”¯æŒå¤šç§å‹ç¼©æ ¼å¼å’Œçµæ´»çš„æ–‡ä»¶å¿½ç•¥è§„åˆ™ã€‚å®ƒæ—¢å¯ä»¥ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸º Rust åº“é›†æˆåˆ°å…¶ä»–é¡¹ç›®ä¸­ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒ ZIPã€TAR.GZã€7Z ä¸‰ç§ä¸»æµå‹ç¼©æ ¼å¼
- **æ™ºèƒ½é…ç½®**: é€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰å‹ç¼©é€‰é¡¹å’Œå¿½ç•¥è§„åˆ™
- **Gitignoreé£æ ¼**: ä½¿ç”¨ç±»ä¼¼ .gitignore çš„è¯­æ³•æ¥å¿½ç•¥ä¸éœ€è¦çš„æ–‡ä»¶
- **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå‹ç¼©è¿›åº¦å’Œæ–‡ä»¶å¤§å°ä¿¡æ¯
- **ç®€æ´æ˜“ç”¨**: é»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œå‹ç¼©
- **å¯å¤ç”¨åº“**: æ ¸å¿ƒåŠŸèƒ½å·²å°è£…ä¸º Rust åº“ `ztr_lib`ï¼Œæ–¹ä¾¿äºŒæ¬¡å¼€å‘å’Œé›†æˆ

## ğŸ“¦ å®‰è£…

### ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·

#### ä»æºç ç¼–è¯‘

```bash
git clone <repository-url>
cd ztr
cargo build --release
```

ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ä½äº `target/release/ztr.exe` (Windows) æˆ– `target/release/ztr` (Linux/macOS)ã€‚

### ä½œä¸º Rust åº“

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ `Cargo.toml` ä¸­ï¼š

```toml
[dependencies]
ztr_lib = "2.0.0" # æ›¿æ¢ä¸ºå®é™…ç‰ˆæœ¬å·
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·

#### åŸºæœ¬ç”¨æ³•

```bash
# ç›´æ¥å‹ç¼©å½“å‰ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ ztr.toml é…ç½®æ–‡ä»¶ï¼‰
ztr

# åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
ztr init

# æŸ¥çœ‹æ”¯æŒçš„å‹ç¼©æ ¼å¼
ztr show

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶å‹ç¼©
ztr compress --config my-config.toml

# å‹ç¼©æŒ‡å®šç›®å½•
ztr compress --path /path/to/my/folder

# ä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶å‹ç¼©æŒ‡å®šç›®å½•
ztr compress --config my-config.toml --path /path/to/my/folder
```

#### å‘½ä»¤è¯´æ˜

- `ztr` (é»˜è®¤è¡Œä¸º)
  æ£€æŸ¥å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨ `ztr.toml` é…ç½®æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿›è¡Œå‹ç¼©ã€‚

- `ztr init`
  åœ¨å½“å‰ç›®å½•åˆ›å»ºé»˜è®¤çš„ `ztr.toml` é…ç½®æ–‡ä»¶ã€‚

- `ztr show`
  æ˜¾ç¤ºæ‰€æœ‰æ”¯æŒçš„å‹ç¼©æ ¼å¼ã€‚

- `ztr compress`
  å‹ç¼©å½“å‰ç›®å½•ã€‚å¯é€šè¿‡ `--config` å‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé€šè¿‡ `--path` å‚æ•°æŒ‡å®šè¦å‹ç¼©çš„ç›®å½•ã€‚å¦‚æœæœªæŒ‡å®š `--path`ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰ç›®å½•ã€‚

### ä½œä¸º Rust åº“

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ Rust é¡¹ç›®ä¸­ä½¿ç”¨ `ztr_lib` è¿›è¡Œå‹ç¼©ï¼š

```rust
use ztr_lib::config::Config;
use ztr_lib::compressor;
use ztr_lib::ignore_rules::IgnoreRules;
use std::path::{Path, PathBuf};
use walkdir::WalkDir;

fn main() -> anyhow::Result<()> {
    // å‡è®¾ ztr.toml é…ç½®æ–‡ä»¶å­˜åœ¨äºå½“å‰ç›®å½•
    let config_path = PathBuf::from("ztr.toml");
    let config = Config::load(&config_path)?;

    // æŒ‡å®šè¦å‹ç¼©çš„ç›®å½•ï¼Œä¾‹å¦‚å½“å‰ç›®å½•
    let base_dir = std::env::current_dir()?;

    // æ”¶é›†æ‰€æœ‰æ–‡ä»¶è·¯å¾„
    let mut all_files: Vec<PathBuf> = Vec::new();
    for entry in WalkDir::new(&base_dir).into_iter().filter_map(|e| e.ok()) {
        all_files.push(entry.path().to_path_buf());
    }

    // åº”ç”¨å¿½ç•¥è§„åˆ™
    let ignore_rules = IgnoreRules::new(
        &config.get_ignore_rules(),
        &base_dir,
    )?;
    let files_to_compress = ignore_rules.filter_files(all_files.into_iter())?;

    // æ‰§è¡Œå‹ç¼©æ“ä½œ
    let output_archive_path = compressor::compress_directory(
        &config,
        &base_dir,
        files_to_compress,
    )?;
    println!("å‹ç¼©æ–‡ä»¶å·²åˆ›å»º: {}", output_archive_path.display());

    Ok(())
}
```

æ›´è¯¦ç»†çš„åº“ä½¿ç”¨æ–‡æ¡£å¯ä»¥é€šè¿‡ `cargo doc --open` å‘½ä»¤ç”Ÿæˆå¹¶æŸ¥çœ‹ã€‚

## âš™ï¸ é…ç½®æ–‡ä»¶

`ztr.toml` é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š

```toml
# ZTR å‹ç¼©å·¥å…·é…ç½®æ–‡ä»¶

# å‹ç¼©æ ¼å¼: æ”¯æŒ "zip", "tar.gz", "7z"
format = "tar.gz"

# è¾“å‡ºæ–‡ä»¶å (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•å)
# output_name = "my_archive"

# å¿½ç•¥è§„åˆ™åˆ—è¡¨ (ç±»ä¼¼ .gitignore)
ignore = [
    "target/",
    "*.tmp",
    "*.log",
    ".DS_Store",
    "Thumbs.db",
    "*.swp",
    "*.swo",
    "*~",
    ".git/",
    ".svn/",
    ".hg/",
    "node_modules/",
    "__pycache__/",
    ".pytest_cache/",
    ".venv/",
    "venv/",
    "env/",
    "*.pyc",
    "*.pyo",
    "*.pyd",
    ".idea/",
    ".vscode/",
    "*.iml",
]

# æŒ‡å®šå¿½ç•¥æ–‡ä»¶è·¯å¾„ (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ .gitignore)
# ignore_file = "./.gitignore"
```

### é…ç½®é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `format` | å­—ç¬¦ä¸² | æ˜¯ | å‹ç¼©æ ¼å¼ï¼Œæ”¯æŒ "zip"ã€"tar.gz"ã€"7z" |
| `output_name` | å­—ç¬¦ä¸² | å¦ | è¾“å‡ºæ–‡ä»¶åï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•å |
| `ignore` | æ•°ç»„ | å¦ | å¿½ç•¥è§„åˆ™åˆ—è¡¨ï¼Œä¼˜å…ˆçº§é«˜äº `ignore_file` |
| `ignore_file` | å­—ç¬¦ä¸² | å¦ | æŒ‡å®šå¿½ç•¥æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ `.gitignore` |

### å¿½ç•¥è§„åˆ™ä¼˜å…ˆçº§

1. å¦‚æœé…ç½®äº† `ignore` æ•°ç»„ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨æ•°ç»„ä¸­çš„è§„åˆ™
2. å¦‚æœæ²¡æœ‰é…ç½® `ignore` ä½†é…ç½®äº† `ignore_file`ï¼Œåˆ™ä»æŒ‡å®šæ–‡ä»¶è¯»å–è§„åˆ™
3. ä¸¤è€…éƒ½æ²¡æœ‰é…ç½®åˆ™ä¸å¿½ç•¥ä»»ä½•æ–‡ä»¶

## ğŸ“ å¿½ç•¥è§„åˆ™è¯­æ³•

å¿½ç•¥è§„åˆ™æ”¯æŒä»¥ä¸‹è¯­æ³•æ¨¡å¼ï¼š

| æ¨¡å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `*` | åŒ¹é…ä»»æ„å­—ç¬¦ | `*.tmp` åŒ¹é…æ‰€æœ‰ .tmp æ–‡ä»¶ |
| `/` | ç›®å½•åˆ†éš”ç¬¦ | `target/` åŒ¹é… target ç›®å½•åŠå…¶å†…å®¹ |
| `?` | å•ä¸ªå­—ç¬¦ | `???.txt` åŒ¹é…ä¸‰ä¸ªå­—ç¬¦çš„ .txt æ–‡ä»¶ |
| `[]` | å­—ç¬¦èŒƒå›´ | `[abc]*.txt` åŒ¹é…ä»¥ aã€b æˆ– c å¼€å¤´çš„ .txt æ–‡ä»¶ |
| `!` | å¦å®šè§„åˆ™ | `!important.log` ä¸å¿½ç•¥ important.log æ–‡ä»¶ |
| `#` | æ³¨é‡Š | `# è¿™æ˜¯æ³¨é‡Š` |

## ğŸ¯ æ”¯æŒçš„å‹ç¼©æ ¼å¼

| æ ¼å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **zip** | å…¼å®¹æ€§æœ€å¥½ï¼Œå‡ ä¹æ‰€æœ‰ç³»ç»Ÿéƒ½æ”¯æŒ | è·¨å¹³å°æ–‡ä»¶ä¼ è¾“ |
| **tar.gz** | Linux å¸¸ç”¨æ ¼å¼ï¼Œå‹ç¼©ç‡é€‚ä¸­ | Linux/Unix ç¯å¢ƒéƒ¨ç½² |
| **7z** | å‹ç¼©ç‡æœ€é«˜ï¼Œæ”¯æŒå¤šç§ç®—æ³• | éœ€è¦æœ€å¤§å‹ç¼©ç‡çš„åœºæ™¯ |

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å‹ç¼© Rust é¡¹ç›®

```bash
# åœ¨ Rust é¡¹ç›®æ ¹ç›®å½•
ztr init
# ç¼–è¾‘ ztr.tomlï¼Œç¡®ä¿åŒ…å« target/ å¿½ç•¥è§„åˆ™
ztr
```

### ç¤ºä¾‹ 2: å‹ç¼© Node.js é¡¹ç›®

```toml
# ztr.toml
format = "zip"
output_name = "my-node-app"
ignore = [
    "node_modules/",
    "*.log",
    ".env",
    "dist/",
    "coverage/",
]
```

### ç¤ºä¾‹ 3: ä½¿ç”¨ç°æœ‰çš„ .gitignore

```toml
# ztr.toml
format = "tar.gz"
ignore_file = "./.gitignore"
```

## ğŸ”§ å¼€å‘

### é¡¹ç›®ç»“æ„

```
ztr/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ lib.rs           # åº“å…¥å£
â”‚   â”œâ”€â”€ config.rs        # é…ç½®æ–‡ä»¶è§£æ
â”‚   â”œâ”€â”€ compressor.rs    # å‹ç¼©åŠŸèƒ½å®ç°
â”‚   â””â”€â”€ ignore_rules.rs  # å¿½ç•¥è§„åˆ™å¤„ç†
â”œâ”€â”€ Cargo.toml           # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ ztr.toml           # é»˜è®¤é…ç½®æ–‡ä»¶ç¤ºä¾‹
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

### ä¾èµ–åº“

- `clap`: å‘½ä»¤è¡Œå‚æ•°è§£æ
- `serde`: åºåˆ—åŒ–/ååºåˆ—åŒ–
- `toml`: TOML é…ç½®æ–‡ä»¶è§£æ
- `zip`: ZIP æ ¼å¼æ”¯æŒ
- `tar`: TAR æ ¼å¼æ”¯æŒ
- `flate2`: GZIP å‹ç¼©æ”¯æŒ
- `sevenz-rust`: 7Z æ ¼å¼æ”¯æŒ
- `ignore`: Gitignore é£æ ¼çš„æ–‡ä»¶è¿‡æ»¤
- `indicatif`: è¿›åº¦æ¡æ˜¾ç¤º
- `anyhow`: é”™è¯¯å¤„ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ åé¦ˆ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š

- æäº¤ [Issue](../../issues)
- å‘é€é‚®ä»¶è‡³ï¼š[your-email@example.com]

---

**ZTR** - è®©å‹ç¼©å˜å¾—ç®€å•è€Œæ™ºèƒ½ï¼ ğŸ‰